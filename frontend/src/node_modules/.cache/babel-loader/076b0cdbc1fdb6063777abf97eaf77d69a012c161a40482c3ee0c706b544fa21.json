{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport { pickChakraRandomColor, swap } from '../utils/helpers.ts';\nimport { debug } from '../utils/logging.ts';\nimport useTaskCollection from './useTaskCollection.ts';\nimport firebase from \"firebase/compat/app\";\nimport 'firebase/compat/firestore';\nconst MAX_TASK_PER_COLUMN = 100;\nconst firestore = firebase.firestore();\nconst tasksCollection = firestore.collection('tasks');\nconst taskQueryById = id => tasksCollection.where('id', '==', id);\nconst saveTask = task => {\n  tasksCollection.add(task).then(_ => console.log(`task added: ${task.id}`));\n};\nconst deleteTaskById = taskId => {\n  taskQueryById(taskId).get().then(snapshot => {\n    snapshot.forEach(doc => doc.ref.delete());\n    console.log(`task deleted: ${taskId}`);\n  });\n};\nfunction useColumnTasks(column) {\n  _s();\n  const [tasks, setTasks] = useTaskCollection();\n  const columnTasks = tasks[column];\n  const addEmptyTask = useCallback(() => {\n    debug(`Adding new empty task to ${column} column`);\n    setTasks(allTasks => {\n      const columnTasks = allTasks[column];\n      if (columnTasks.length > MAX_TASK_PER_COLUMN) {\n        debug('Too many task!');\n        return allTasks;\n      }\n      const newColumnTask = {\n        id: uuidv4(),\n        title: `New ${column} task`,\n        color: pickChakraRandomColor('.300'),\n        column\n      };\n      saveTask(newColumnTask);\n      return {\n        ...allTasks,\n        [column]: [newColumnTask, ...columnTasks]\n      };\n    });\n  }, [column, setTasks]);\n  const deleteTask = useCallback(id => {\n    debug(`Removing task ${id}..`);\n    setTasks(allTasks => {\n      const columnTasks = allTasks[column];\n      deleteTaskById(id);\n      return {\n        ...allTasks,\n        [column]: columnTasks.filter(task => task.id !== id)\n      };\n    });\n  }, [column, setTasks]);\n  const updateTask = useCallback((id, updatedTask) => {\n    debug(`Updating task ${id} with ${JSON.stringify(updateTask)}`);\n    setTasks(allTasks => {\n      const columnTasks = allTasks[column];\n      return {\n        ...allTasks,\n        [column]: columnTasks.map(task => task.id === id ? {\n          ...task,\n          ...updatedTask\n        } : task)\n      };\n    });\n  }, [column, setTasks]);\n  const dropTaskFrom = useCallback((from, id) => {\n    setTasks(allTasks => {\n      const fromColumnTasks = allTasks[from];\n      const toColumnTasks = allTasks[column];\n      const movingTask = fromColumnTasks.find(task => task.id === id);\n      console.log(`Moving task ${movingTask === null || movingTask === void 0 ? void 0 : movingTask.id} from ${from} to ${column}`);\n      if (!movingTask) {\n        return allTasks;\n      }\n\n      // remove the task from the original column and copy it within the destination column\n      return {\n        ...allTasks,\n        [from]: fromColumnTasks.filter(task => task.id !== id),\n        [column]: [{\n          ...movingTask,\n          column\n        }, ...toColumnTasks]\n      };\n    });\n  }, [column, setTasks]);\n  const swapTasks = useCallback((i, j) => {\n    debug(`Swapping task ${i} with ${j} in ${column} column`);\n    setTasks(allTasks => {\n      const columnTasks = allTasks[column];\n      return {\n        ...allTasks,\n        [column]: swap(columnTasks, i, j)\n      };\n    });\n  }, [column, setTasks]);\n  return {\n    tasks: columnTasks,\n    addEmptyTask,\n    updateTask,\n    dropTaskFrom,\n    deleteTask,\n    swapTasks\n  };\n}\n_s(useColumnTasks, \"qEIoA/2RkhIvXKVJD4E22oyq9C0=\", false, function () {\n  return [useTaskCollection];\n});\nexport default useColumnTasks;","map":{"version":3,"names":["useCallback","v4","uuidv4","pickChakraRandomColor","swap","debug","useTaskCollection","firebase","MAX_TASK_PER_COLUMN","firestore","tasksCollection","collection","taskQueryById","id","where","saveTask","task","add","then","_","console","log","deleteTaskById","taskId","get","snapshot","forEach","doc","ref","delete","useColumnTasks","column","_s","tasks","setTasks","columnTasks","addEmptyTask","allTasks","length","newColumnTask","title","color","deleteTask","filter","updateTask","updatedTask","JSON","stringify","map","dropTaskFrom","from","fromColumnTasks","toColumnTasks","movingTask","find","swapTasks","i","j"],"sources":["/Users/jason/bizchina/src/dashboard/hooks/useColumnTasks.ts"],"sourcesContent":["import { useCallback } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport { ColumnType } from '../utils/enums';\nimport { pickChakraRandomColor, swap } from '../utils/helpers.ts';\nimport { debug } from '../utils/logging.ts';\nimport { TaskModel } from '../utils/models.ts';\nimport useTaskCollection from './useTaskCollection.ts';\nimport firebase from \"firebase/compat/app\";\nimport 'firebase/compat/firestore';\n\nconst MAX_TASK_PER_COLUMN = 100;\n\nconst firestore = firebase.firestore();\n\nconst tasksCollection = firestore.collection('tasks');\nconst taskQueryById = (id) => tasksCollection.where('id', '==', id);\n\nconst saveTask = (task: TaskModel) => {\n  tasksCollection.add(task)\n      .then(_ => console.log(`task added: ${task.id}`));\n}\n\n\nconst deleteTaskById = (taskId: TaskModel['id']) => {\n  taskQueryById(taskId)\n      .get()\n      .then(snapshot => {\n        snapshot.forEach(doc => doc.ref.delete());\n        console.log(`task deleted: ${taskId}`);\n      });\n}\n\nfunction useColumnTasks(column: ColumnType) {\n  const [tasks, setTasks] = useTaskCollection();\n\n  const columnTasks = tasks[column];\n\n  const addEmptyTask = useCallback(() => {\n    debug(`Adding new empty task to ${column} column`);\n    setTasks((allTasks) => {\n      const columnTasks = allTasks[column];\n\n      if (columnTasks.length > MAX_TASK_PER_COLUMN) {\n        debug('Too many task!');\n        return allTasks;\n      }\n\n      const newColumnTask: TaskModel = {\n        id: uuidv4(),\n        title: `New ${column} task`,\n        color: pickChakraRandomColor('.300'),\n        column,\n      };\n\n      saveTask(newColumnTask);\n\n      return {\n        ...allTasks,\n        [column]: [newColumnTask, ...columnTasks],\n      };\n    });\n  }, [column, setTasks]);\n\n  const deleteTask = useCallback(\n    (id: TaskModel['id']) => {\n      debug(`Removing task ${id}..`);\n      setTasks((allTasks) => {\n        const columnTasks = allTasks[column];\n\n        deleteTaskById(id);\n\n        return {\n          ...allTasks,\n          [column]: columnTasks.filter((task) => task.id !== id),\n        };\n      });\n    },\n    [column, setTasks],\n  );\n\n  const updateTask = useCallback(\n    (id: TaskModel['id'], updatedTask: Omit<Partial<TaskModel>, 'id'>) => {\n      debug(`Updating task ${id} with ${JSON.stringify(updateTask)}`);\n      setTasks((allTasks) => {\n        const columnTasks = allTasks[column];\n        return {\n          ...allTasks,\n          [column]: columnTasks.map((task) =>\n            task.id === id ? { ...task, ...updatedTask } : task,\n          ),\n        };\n      });\n    },\n    [column, setTasks],\n  );\n\n  const dropTaskFrom = useCallback(\n    (from: ColumnType, id: TaskModel['id']) => {\n      setTasks((allTasks) => {\n        const fromColumnTasks = allTasks[from];\n        const toColumnTasks = allTasks[column];\n        const movingTask = fromColumnTasks.find((task) => task.id === id);\n\n        console.log(`Moving task ${movingTask?.id} from ${from} to ${column}`);\n\n        if (!movingTask) {\n          return allTasks;\n        }\n\n        // remove the task from the original column and copy it within the destination column\n        return {\n          ...allTasks,\n          [from]: fromColumnTasks.filter((task) => task.id !== id),\n          [column]: [{ ...movingTask, column }, ...toColumnTasks],\n        };\n      });\n    },\n    [column, setTasks],\n  );\n\n  const swapTasks = useCallback(\n    (i: number, j: number) => {\n      debug(`Swapping task ${i} with ${j} in ${column} column`);\n      setTasks((allTasks) => {\n        const columnTasks = allTasks[column];\n        return {\n          ...allTasks,\n          [column]: swap(columnTasks, i, j),\n        };\n      });\n    },\n    [column, setTasks],\n  );\n\n  return {\n    tasks: columnTasks,\n    addEmptyTask,\n    updateTask,\n    dropTaskFrom,\n    deleteTask,\n    swapTasks,\n  };\n}\n\nexport default useColumnTasks;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}